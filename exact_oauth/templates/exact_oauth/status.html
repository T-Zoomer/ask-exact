{% extends 'exact_oauth/base.html' %}

{% block title %}Exact Online OAuth Status{% endblock %}
{% block header %}Exact Online OAuth Status{% endblock %}

{% block content %}
    <div class="section">
        <h2>Configuration Status</h2>
        <div class="card">
            {% if configured %}
                <p>✅ <strong>Configured:</strong> Environment variables are set</p>
                <p><strong>Country:</strong> {{ config.country }}</p>
                <p><strong>Redirect URI:</strong> {{ config.redirect_uri }}</p>
            {% else %}
                <p>❌ <strong>Not Configured:</strong> Missing environment variables</p>
                <p>Please set the following environment variables:</p>
                <ul>
                    <li><code>EXACT_CLIENT_ID</code></li>
                    <li><code>EXACT_CLIENT_SECRET</code></li>
                    <li><code>EXACT_COUNTRY</code> (optional, defaults to NL)</li>
                </ul>
            {% endif %}
        </div>
    </div>

    <div class="section">
        <h2>Authorization Status</h2>
        <div class="card">
            {% if has_token %}
                {% if is_expired %}
                    <p>❌ <strong>Token Expired</strong></p>
                    <p>Your token expired on {{ token.expires_at|date:"Y-m-d H:i:s" }} UTC</p>
                {% elif expires_soon %}
                    <p>⚠️ <strong>Token Expires Soon</strong></p>
                    <p>Your token will expire on {{ token.expires_at|date:"Y-m-d H:i:s" }} UTC</p>
                {% else %}
                    <p>✅ <strong>Authorized</strong></p>
                    <p>Token expires on {{ token.expires_at|date:"Y-m-d H:i:s" }} UTC</p>
                {% endif %}
                
                {% if token.division %}
                    <p><strong>Division:</strong> {{ token.division }}</p>
                {% endif %}
                
                <div style="margin-top: 20px;">
                    <a href="{% url 'exact_oauth:refresh_token' %}" class="btn btn-success">Refresh Token</a>
                    <form method="post" action="{% url 'exact_oauth:revoke' %}" style="display: inline;">
                        {% csrf_token %}
                        <button type="submit" class="btn btn-danger" onclick="return confirm('Are you sure you want to revoke access?')">Revoke Access</button>
                    </form>
                </div>
            {% else %}
                <p>❌ <strong>Not Authorized</strong></p>
                {% if configured %}
                    <a href="{% url 'exact_oauth:authorize' %}" class="btn btn-primary">Authorize Now</a>
                {% else %}
                    <p>Configure environment variables first</p>
                {% endif %}
            {% endif %}
        </div>
    </div>

{% endblock %}